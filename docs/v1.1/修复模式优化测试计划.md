# 修复模式优化测试计划

## 测试环境要求
- Windows 11 或 Windows 10
- 具有管理员权限
- .NET 8.0 运行时
- 应用程序已编译并可以运行

## 测试场景

### 场景1：目标文件夹为空时不触发修复模式

**测试步骤**:
1. 创建一个空的源目录（或不存在）
2. 创建一个空的目标目录
3. 启动应用程序
4. 在手动模式下设置源路径和目标路径
5. 观察UI上是否出现修复模式提示

**预期结果**:
- 不应该出现"🔧 检测到可修复"的提示
- 不应该显示"修复链接"按钮
- 只显示"开始扫描"或"开始验证"按钮

**验证点**:
- [`CheckRepairCondition()`](MoveWithSymlinkWPF/ViewModels/MainViewModel.cs:1031) 方法正确返回
- `CanRepair` 属性保持为 `false`
- UI 不显示修复相关的提示和按钮

### 场景1.5：源目录和目标目录相同时不触发修复模式

**测试步骤**:
1. 创建一个源目录（包含一些文件）
2. 设置目标路径与源路径相同
3. 启动应用程序
4. 在手动模式下设置源路径和目标路径
5. 观察UI上是否出现修复模式提示

**预期结果**:
- 不应该出现"🔧 检测到可修复"的提示
- 不应该显示"修复链接"按钮
- 只显示"开始扫描"或"开始验证"按钮

**验证点**:
- [`CheckRepairCondition()`](MoveWithSymlinkWPF/ViewModels/MainViewModel.cs:1031) 方法正确返回
- `CanRepair` 属性保持为 `false`
- UI 不显示修复相关的提示和按钮

### 场景2：目标文件夹不为空时正常触发修复模式

**测试步骤**:
1. 创建一个源目录（包含一些文件）
2. 创建一个非空的目标目录（包含一些文件）
3. 启动应用程序
4. 在手动模式下设置源路径和目标路径
5. 观察UI上的修复模式提示

**预期结果**:
- 应该出现"🔧 检测到可修复"的提示
- 显示相应的修复提示信息
- 显示"修复链接"按钮

**验证点**:
- `CanRepair` 属性设置为 `true`
- `RepairHint` 包含有意义的提示信息
- UI 正确显示修复相关的提示和按钮

### 场景3：修复完成后的备份处理

**测试步骤**:
1. 创建一个包含内容的源目录
2. 创建一个非空的目标目录
3. 执行修复操作
4. 观察修复完成后的备份处理提示

**预期结果**:
- 出现"备份处理提示"对话框
- 提示信息为："修复过程中创建了备份目录：[备份路径]\n\n请自行删除此备份目录。\n\n是否打开备份所在目录？"
- 点击"是"时，打开备份所在的文件夹
- 点击"否"时，在日志中记录"备份已保留，请用户自行处理"

**验证点**:
- [`CheckAndCleanupRepairBackupV2Async()`](MoveWithSymlinkWPF/ViewModels/MainViewModel.cs:1225) 方法被正确调用
- 备份目录路径正确显示
- 文件管理器正确打开到备份所在目录
- 日志记录正确

## 测试数据准备

### 测试目录结构
```
C:\temp\repair_test\
├── source\               # 源目录
│   ├── file1.txt
│   ├── file2.txt
│   └── subfolder\
│       └── file3.txt
├── target_empty\         # 空目标目录
└── target_nonempty\      # 非空目标目录
    ├── data1.txt
    ├── data2.txt
    └── subfolder\
        └── data3.txt
```

## 回归测试

### 确保原有功能不受影响

1. **迁移模式**：确保正常的迁移功能仍然工作
2. **还原模式**：确保正常的还原功能仍然工作
3. **一键迁移**：确保一键迁移功能仍然工作

### 边界情况测试

1. **目标目录不存在**：确保不会触发修复模式
2. **源路径为空**：确保不会触发修复模式
3. **目标目录包含系统文件**：确保正确检测用户内容
4. **权限不足的情况**：确保错误处理正确

## 测试记录模板

```
测试日期：____
测试人员：____
测试环境：Windows 11 / Windows 10

场景1 - 目标文件夹为空：
- [ ] 不触发修复模式
- [ ] UI显示正确
- [ ] 备注说明：____

场景2 - 目标文件夹不为空：
- [ ] 正确触发修复模式
- [ ] 提示信息正确
- [ ] UI显示正确
- [ ] 备注说明：____

场景3 - 修复完成后备份处理：
- [ ] 备份提示出现
- [ ] 提示信息正确
- [ ] 点击"是"打开文件夹
- [ ] 点击"否"保留备份
- [ ] 日志记录正确
- [ ] 备注说明：____

回归测试：
- [ ] 迁移模式正常
- [ ] 还原模式正常
- [ ] 一键迁移正常
- [ ] 备注说明：____

总体评估：
[ ] 通过
[ ] 部分通过
[ ] 不通过

问题和建议：
____
```

## 测试完成标准

- 所有测试场景都按预期工作
- 原有功能没有受到负面影响
- 用户体验得到改善
- 错误处理机制正常工作

## 已知限制

1. 文件管理器的打开依赖于系统的 `explorer.exe`
2. 在某些受限环境中可能无法打开文件夹
3. 备份目录的清理完全依赖用户手动操作