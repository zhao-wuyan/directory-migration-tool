# æ„å»ºä¸å‘å¸ƒå·¥ä½œæµ

## å¿«é€Ÿå‚è€ƒ

```
å¼€å‘ â†’ æµ‹è¯• â†’ å‘å¸ƒ
  â†“      â†“      â†“
run   lite   both
```

## å®Œæ•´å·¥ä½œæµ

### 1ï¸âƒ£ å¼€å‘é˜¶æ®µ

**ç›®æ ‡ï¼š** å¿«é€Ÿè¿­ä»£å’Œè°ƒè¯•

**æ¨èå‘½ä»¤ï¼š**
```powershell
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
.\run.ps1

# æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ
cd MoveWithSymlinkWPF
dotnet run -c Release
```

**ç‰¹ç‚¹ï¼š**
- âš¡ å¯åŠ¨å¿«é€Ÿï¼ˆæ— éœ€å‘å¸ƒï¼‰
- ğŸ”§ æ”¯æŒçƒ­é‡è½½å’Œè°ƒè¯•
- ğŸ’¾ ä¸ç”Ÿæˆå‘å¸ƒæ–‡ä»¶

**è¾“å‡ºä½ç½®ï¼š**
```
MoveWithSymlinkWPF/bin/Release/net8.0-windows10.0.19041.0/
â”œâ”€â”€ ç›®å½•è¿ç§»å·¥å…·.exe    # æ¡†æ¶ä¾èµ–å¯åŠ¨å™¨
â”œâ”€â”€ ç›®å½•è¿ç§»å·¥å…·.dll    # åº”ç”¨ç¨‹åº DLL
â””â”€â”€ ...
```

---

### 2ï¸âƒ£ å†…éƒ¨æµ‹è¯•é˜¶æ®µ

**ç›®æ ‡ï¼š** å¿«é€Ÿåˆ†å‘ç»™æµ‹è¯•äººå‘˜

**æ¨èå‘½ä»¤ï¼š**
```powershell
# å‘å¸ƒè½»é‡ç‰ˆï¼ˆä¸å¢åŠ ç‰ˆæœ¬å·ï¼‰
.\publish.ps1 -Mode lite -SkipVersionIncrement
```

**ç‰¹ç‚¹ï¼š**
- ğŸ“¦ ä½“ç§¯å°ï¼ˆçº¦ 2-5 MBï¼‰
- ğŸš€ æ„å»ºå¿«é€Ÿ
- ğŸ“¤ åˆ†å‘ä¾¿æ·
- âš ï¸ éœ€è¦è¿è¡Œæ—¶

**è¾“å‡ºä½ç½®ï¼š**
```
MoveWithSymlinkWPF/bin/publish/win-x64-framework-dependent/
â””â”€â”€ ç›®å½•è¿ç§»å·¥å…·-v{ç‰ˆæœ¬å·}-lite.exe
```

**åˆ†å‘æ­¥éª¤ï¼š**
1. æ„å»ºè½»é‡ç‰ˆ EXE
2. å¤åˆ¶ EXE åˆ°å…±äº«ä½ç½®
3. ç¡®ä¿æµ‹è¯•äººå‘˜å·²å®‰è£… .NET 8.0 Desktop Runtime
4. æµ‹è¯•äººå‘˜ä¸‹è½½å¹¶è¿è¡Œ

**ç³»ç»Ÿè¦æ±‚æ£€æŸ¥ï¼š**
```powershell
# æµ‹è¯•äººå‘˜å¯è¿è¡Œæ­¤å‘½ä»¤æ£€æŸ¥è¿è¡Œæ—¶
dotnet --list-runtimes | Select-String "Microsoft.WindowsDesktop.App 8\."
```

å¦‚æœæ²¡æœ‰è¿è¡Œæ—¶ï¼š
- ä¸‹è½½åœ°å€ï¼šhttps://dotnet.microsoft.com/download/dotnet/8.0
- é€‰æ‹©ï¼š**.NET Desktop Runtime 8.0.x (x64)**

---

### 3ï¸âƒ£ æ­£å¼å‘å¸ƒé˜¶æ®µ

**ç›®æ ‡ï¼š** æä¾›ç»™æœ€ç»ˆç”¨æˆ·çš„ç¨³å®šç‰ˆæœ¬

#### é€‰é¡¹ A: ä»…å‘å¸ƒè‡ªåŒ…å«ç‰ˆæœ¬

```powershell
# å‘å¸ƒå®Œæ•´ç‰ˆï¼ˆè‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·ï¼‰
.\publish.ps1
```

**é€‚ç”¨åœºæ™¯ï¼š**
- é¢å‘æ™®é€šç”¨æˆ·
- ä¸ç¡®å®šç”¨æˆ·è¿è¡Œæ—¶ç¯å¢ƒ
- è¿½æ±‚æœ€ä½³ç”¨æˆ·ä½“éªŒ

#### é€‰é¡¹ B: åŒæ—¶å‘å¸ƒä¸¤ä¸ªç‰ˆæœ¬ï¼ˆæ¨èï¼‰

```powershell
# åŒæ—¶å‘å¸ƒä¸¤ä¸ªç‰ˆæœ¬
.\publish.ps1 -Mode both
```

**ä¼˜åŠ¿ï¼š**
- ç”¨æˆ·å¯æ ¹æ®éœ€æ±‚é€‰æ‹©
- æœ‰è¿è¡Œæ—¶ â†’ ä¸‹è½½è½»é‡ç‰ˆ
- æ²¡è¿è¡Œæ—¶ â†’ ä¸‹è½½å®Œæ•´ç‰ˆ

**è¾“å‡ºä½ç½®ï¼š**
```
MoveWithSymlinkWPF/bin/publish/
â”œâ”€â”€ win-x64/
â”‚   â””â”€â”€ ç›®å½•è¿ç§»å·¥å…·-v{ç‰ˆæœ¬å·}.exe           # è‡ªåŒ…å«ç‰ˆï¼ˆ70-100 MBï¼‰
â””â”€â”€ win-x64-framework-dependent/
    â””â”€â”€ ç›®å½•è¿ç§»å·¥å…·-v{ç‰ˆæœ¬å·}-lite.exe      # æ¡†æ¶ä¾èµ–ç‰ˆï¼ˆ2-5 MBï¼‰
```

**å‘å¸ƒè¯´æ˜æ¨¡æ¿ï¼š**
```markdown
## ä¸‹è½½

### å®Œæ•´ç‰ˆï¼ˆæ¨èï¼‰
- æ–‡ä»¶ï¼šç›®å½•è¿ç§»å·¥å…·-v1.0.6.exe
- å¤§å°ï¼šçº¦ 75 MB
- æ— éœ€å®‰è£…ä»»ä½•ä¾èµ–
- é€‚åˆæ‰€æœ‰ç”¨æˆ·

### è½»é‡ç‰ˆ
- æ–‡ä»¶ï¼šç›®å½•è¿ç§»å·¥å…·-v1.0.6-lite.exe
- å¤§å°ï¼šçº¦ 3 MB
- éœ€è¦ .NET 8.0 Desktop Runtime
- é€‚åˆå·²æœ‰è¿è¡Œæ—¶çš„ç”¨æˆ·
- [ä¸‹è½½è¿è¡Œæ—¶](https://dotnet.microsoft.com/download/dotnet/8.0)
```

---

## å·¥ä½œæµå›¾ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼€å‘é˜¶æ®µ                             â”‚
â”‚  .\run.ps1  æˆ–  dotnet run                              â”‚
â”‚  â†“                                                      â”‚
â”‚  å¿«é€Ÿæµ‹è¯• â†’ ä¿®æ”¹ä»£ç  â†’ é‡æ–°è¿è¡Œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å†…éƒ¨æµ‹è¯•é˜¶æ®µ                           â”‚
â”‚  .\publish.ps1 -Mode lite -SkipVersionIncrement         â”‚
â”‚  â†“                                                      â”‚
â”‚  ç”Ÿæˆè½»é‡ç‰ˆ â†’ åˆ†å‘ç»™æµ‹è¯•äººå‘˜ â†’ æ”¶é›†åé¦ˆ                  â”‚
â”‚  â†“                                                      â”‚
â”‚  å¦‚æœ‰é—®é¢˜ â†’ è¿”å›å¼€å‘é˜¶æ®µ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ­£å¼å‘å¸ƒé˜¶æ®µ                           â”‚
â”‚  .\publish.ps1 -Mode both                               â”‚
â”‚  â†“                                                      â”‚
â”‚  ç”Ÿæˆä¸¤ä¸ªç‰ˆæœ¬ â†’ ç¼–å†™å‘å¸ƒè¯´æ˜ â†’ ä¸Šä¼ /åˆ†å‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‘½ä»¤é€ŸæŸ¥è¡¨

| é˜¶æ®µ | å‘½ä»¤ | è¾“å‡º | ç‰ˆæœ¬å· |
|------|------|------|--------|
| å¼€å‘ | `.\run.ps1` | æ— å‘å¸ƒæ–‡ä»¶ | ä¸å˜ |
| å¼€å‘ | `dotnet run` | æ— å‘å¸ƒæ–‡ä»¶ | ä¸å˜ |
| æµ‹è¯• | `.\publish.ps1 -Mode lite -SkipVersionIncrement` | è½»é‡ç‰ˆ | ä¸å˜ |
| å‘å¸ƒ | `.\publish.ps1` | å®Œæ•´ç‰ˆ | +1 |
| å‘å¸ƒ | `.\publish.ps1 -Mode lite` | è½»é‡ç‰ˆ | +1 |
| å‘å¸ƒ | `.\publish.ps1 -Mode both` | ä¸¤ä¸ªç‰ˆæœ¬ | +1 |

---

## ç‰ˆæœ¬å·ç®¡ç†

### è‡ªåŠ¨é€’å¢ï¼ˆé»˜è®¤ï¼‰

```powershell
# å‘å¸ƒæ—¶è‡ªåŠ¨é€’å¢ patch ç‰ˆæœ¬å·
.\publish.ps1
# 1.0.5 â†’ 1.0.6
```

### æ‰‹åŠ¨æ§åˆ¶

```powershell
# ä¸é€’å¢ç‰ˆæœ¬å·ï¼ˆé‡æ–°å‘å¸ƒï¼‰
.\publish.ps1 -SkipVersionIncrement

# æ‰‹åŠ¨ä¿®æ”¹ version.json
{
  "major": 1,
  "minor": 1,  # æ‰‹åŠ¨æ”¹ä¸º 1.1.x
  "patch": 0
}
```

---

## æ¸…ç†ç­–ç•¥

### å¼€å‘æœŸé—´

```powershell
# æ¸…ç†ä¸­é—´äº§ç‰©ï¼Œä¿ç•™å‘å¸ƒæ–‡ä»¶
.\clean-build.ps1 -KeepPublish
```

**æ¸…ç†å†…å®¹ï¼š**
- `obj/` ç›®å½•ï¼ˆå¯é‡æ–°ç”Ÿæˆï¼‰
- `bin/Release/.../win-x64/` ä¸­é—´äº§ç‰©
- ä¸´æ—¶æ–‡ä»¶

**ä¿ç•™å†…å®¹ï¼š**
- `bin/publish/` å‘å¸ƒæ–‡ä»¶
- `bin/Release/` å¼€å‘æ„å»º

### å®Œå…¨æ¸…ç†

```powershell
# æ¸…ç†æ‰€æœ‰æ„å»ºæ–‡ä»¶
.\clean-build.ps1

# æˆ–ä½¿ç”¨ dotnet å‘½ä»¤
dotnet clean
```

---

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **å¼€å‘æ—¶**
   - ä½¿ç”¨ `.\run.ps1` å¿«é€Ÿå¯åŠ¨
   - ä¸è¦é¢‘ç¹å‘å¸ƒ

2. **æµ‹è¯•æ—¶**
   - ä½¿ç”¨ `-SkipVersionIncrement` é¿å…ç‰ˆæœ¬å·æ··ä¹±
   - ä½¿ç”¨è½»é‡ç‰ˆèŠ‚çœæ—¶é—´å’Œç©ºé—´

3. **å‘å¸ƒæ—¶**
   - åŒæ—¶æä¾›ä¸¤ä¸ªç‰ˆæœ¬ (`-Mode both`)
   - è®©ç”¨æˆ·æ ¹æ®éœ€æ±‚é€‰æ‹©
   - ç¼–å†™æ¸…æ™°çš„ç³»ç»Ÿè¦æ±‚è¯´æ˜

4. **æ¸…ç†æ—¶**
   - å®šæœŸæ¸…ç† `win-x64` ä¸­é—´äº§ç‰©
   - å‘å¸ƒåå¯æ¸…ç†æ—§ç‰ˆæœ¬æ–‡ä»¶

### âŒ é¿å…åšæ³•

1. **ä¸è¦**åœ¨å¼€å‘æ—¶ä½¿ç”¨ `.\publish.ps1`
   - æ„å»ºæ—¶é—´é•¿
   - ä¸å¿…è¦çš„ç‰ˆæœ¬å·é€’å¢

2. **ä¸è¦**æ‰‹åŠ¨åˆ é™¤ `bin` ç›®å½•è€Œä¸æ¸…ç† `obj`
   - å¯èƒ½å¯¼è‡´å¢é‡æ„å»ºé—®é¢˜
   - ä½¿ç”¨ `dotnet clean` æˆ– `.\clean-build.ps1`

3. **ä¸è¦**åªå‘å¸ƒè½»é‡ç‰ˆç»™æ™®é€šç”¨æˆ·
   - å¾ˆå¤šç”¨æˆ·æ²¡æœ‰å®‰è£…è¿è¡Œæ—¶
   - ä¼šå¢åŠ æ”¯æŒè´Ÿæ‹…

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šè½»é‡ç‰ˆæ— æ³•è¿è¡Œ

**ç—‡çŠ¶ï¼š** åŒå‡» EXE æç¤ºéœ€è¦ .NET è¿è¡Œæ—¶

**è§£å†³ï¼š**
```powershell
# æ£€æŸ¥è¿è¡Œæ—¶
dotnet --list-runtimes | Select-String "Microsoft.WindowsDesktop.App 8\."

# å¦‚æœæ²¡æœ‰ï¼Œå®‰è£…è¿è¡Œæ—¶
# https://dotnet.microsoft.com/download/dotnet/8.0
```

### é—®é¢˜ï¼šå‘å¸ƒæ–‡ä»¶æ‰¾ä¸åˆ°

**ç—‡çŠ¶ï¼š** `.\run.ps1` æç¤ºæ²¡æœ‰å‘å¸ƒç‰ˆæœ¬

**è§£å†³ï¼š**
```powershell
# æ‰§è¡Œå‘å¸ƒ
.\publish.ps1

# æ£€æŸ¥è¾“å‡º
ls MoveWithSymlinkWPF\bin\publish\win-x64\*.exe
```

### é—®é¢˜ï¼šç‰ˆæœ¬å·æ²¡æœ‰æ›´æ–°

**ç—‡çŠ¶ï¼š** å‘å¸ƒåç‰ˆæœ¬å·ä»ç„¶æ˜¯æ—§çš„

**åŸå› ï¼š** ä½¿ç”¨äº† `-SkipVersionIncrement` å‚æ•°

**è§£å†³ï¼š**
```powershell
# ä¸ä½¿ç”¨ -SkipVersionIncrement
.\publish.ps1
```

### é—®é¢˜ï¼šæ„å»ºå¤±è´¥

**ç—‡çŠ¶ï¼š** `dotnet build` æˆ– `dotnet publish` æŠ¥é”™

**è§£å†³æ­¥éª¤ï¼š**
```powershell
# 1. æ¸…ç†æ‰€æœ‰æ„å»ºæ–‡ä»¶
dotnet clean

# 2. è¿˜åŸä¾èµ–
dotnet restore

# 3. é‡æ–°æ„å»º
dotnet build -c Release

# 4. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œåˆ é™¤ bin/obj
.\clean-build.ps1 -Force

# 5. é‡æ–°è¿˜åŸå’Œæ„å»º
dotnet restore
dotnet build -c Release
```

---

## è¿›é˜¶æŠ€å·§

### æ‰¹é‡å‘å¸ƒè„šæœ¬

åˆ›å»º `publish-all-versions.ps1`ï¼š

```powershell
# å‘å¸ƒæ‰€æœ‰ç‰ˆæœ¬å¹¶ç”ŸæˆæŠ¥å‘Š
.\publish.ps1 -Mode both

# å¤åˆ¶åˆ°å‘å¸ƒç›®å½•
$version = (Get-Content version.json | ConvertFrom-Json)
$v = "$($version.major).$($version.minor).$($version.patch)"

New-Item -ItemType Directory -Path "releases\v$v" -Force

Copy-Item "MoveWithSymlinkWPF\bin\publish\win-x64\*.exe" `
    -Destination "releases\v$v\"
Copy-Item "MoveWithSymlinkWPF\bin\publish\win-x64-framework-dependent\*.exe" `
    -Destination "releases\v$v\"

# ç”Ÿæˆå‘å¸ƒè¯´æ˜
@"
# Release v$v

## å®Œæ•´ç‰ˆ
- å¤§å°: $(ls releases\v$v\*-v*.exe | %{[math]::Round($_.Length/1MB,2)}) MB
- æ— éœ€è¿è¡Œæ—¶

## è½»é‡ç‰ˆ
- å¤§å°: $(ls releases\v$v\*-lite.exe | %{[math]::Round($_.Length/1MB,2)}) MB
- éœ€è¦ .NET 8.0 Desktop Runtime
"@ | Out-File "releases\v$v\README.md"

Write-Host "Released to releases\v$v\" -ForegroundColor Green
```

### è‡ªåŠ¨åŒ–æµ‹è¯•

```powershell
# æµ‹è¯•ä¸¤ä¸ªç‰ˆæœ¬æ˜¯å¦éƒ½èƒ½æ­£å¸¸ç”Ÿæˆ
.\test-publish.ps1
```

---

## ç›¸å…³æ–‡æ¡£

- [å‘å¸ƒç‰ˆæœ¬è¯´æ˜](./å‘å¸ƒç‰ˆæœ¬è¯´æ˜.md) - è¯¦ç»†çš„ç‰ˆæœ¬ç±»å‹è¯´æ˜
- [æ„å»ºè¾“å‡ºç›®å½•è¯´æ˜](./æ„å»ºè¾“å‡ºç›®å½•è¯´æ˜.md) - ç›®å½•ç»“æ„è¯¦è§£
- [å¿«é€Ÿå‘å¸ƒæŒ‡å—](../å¿«é€Ÿå‘å¸ƒæŒ‡å—.md) - ä¸€é¡µçº¸å‚è€ƒ

---

## æ€»ç»“

| éœ€æ±‚ | æ¨èå‘½ä»¤ |
|------|----------|
| æ—¥å¸¸å¼€å‘ | `.\run.ps1` |
| å†…éƒ¨æµ‹è¯• | `.\publish.ps1 -Mode lite -SkipVersionIncrement` |
| æ­£å¼å‘å¸ƒ | `.\publish.ps1 -Mode both` |
| æ¸…ç†ç©ºé—´ | `.\clean-build.ps1 -KeepPublish` |
| å¯¹æ¯”æµ‹è¯• | `.\test-publish.ps1` |

è®°ä½ï¼š
- å¼€å‘ç”¨ `run`
- æµ‹è¯•ç”¨ `lite`
- å‘å¸ƒç”¨ `both`

